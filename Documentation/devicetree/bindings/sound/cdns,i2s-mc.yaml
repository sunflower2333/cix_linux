# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/sound/cdns,i2s-mc.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title:
  Cadence I2S-MC (MultiChannel) Controller Driver

maintainers:
  - Joakim Zhang <joakim.zhang@cixtech.com>

properties:
  compatible:
    enum:
      - cdns,sky1-i2s-mc

  reg:
    maxItems: 1

  interrupts:
    maxItems: 1

  clocks:
    minItems: 2
    maxItems: 3
    items:
      - description: APB clock is used to provide synchronization of the designâ€™s APB slave
                     interface with external APB master (at the SoC level).
                     The following modules are clocked by hst clock:
                             - U_CDNSI2SSC_APB_SLAVE
                             - U_CDNSI2SSC_SFR
                             - U_CDNSI2SSC_FIFO_RX_APB
                             - U_CDNSI2SSC_FIFO_TX_APB
      - description: The main clock for synchronous logic in I2S transceiver.
                     The following modules are clocked by i2s clock:
                             - U_CDNSI2SMC_TRX_CHNx
                             - U_CDNSI2SMC_RX_CTRL
                             - U_CDNSI2SMC_TX_CTRL
                             - U_CDNSI2SMC_RX_FIFO_I2S
                             - U_CDNSI2SMC_TX_FIFO_I2S
      - description: master clock feeding external codec

  clock-names:
    minItems: 2
    maxItems: 3
    items:
      - const: hst
      - const: i2s
      - const: mclk

  dmas:
    items:
      - description: audio playback dma
      - description: audio capture dma

  dma-names:
    items:
      - const: tx
      - const: rx

  cdns,pin-out-num:
    description: The number of pins brought out by the SoC.
      $ref: /schemas/types.yaml#/definitions/uint8
      minimum: 1
      maximum: 8

  cdns,pin-tx-mask:
    description: |
      Transmit direction pin mask, if a bit is set the corresponding pin masked
      as transmitter.
    $ref: /schemas/types.yaml#/definitions/uint8

  cdns,pin-rx-mask:
    description: |
      Receive direction pin mask, if a bit is set the corresponding pin masked
      as receiver.
    $ref: /schemas/types.yaml#/definitions/uint8

  cdns,cru-ctrl:
    description: Phandle to syscon block which provide access to Clock Reset Unit.

  cdns,mclk-idx:
    description: The index of mclk if mclk is present.

  "#sound-dai-cells":
    const: 1

required:
  - compatible
  - reg
  - interrupts
  - clocks
  - clock-names
  - dmas
  - dma-names
  - cdns,pin-out-num
  - cdns,pin-tx-mask
  - cdns,pin-rx-mask
  - cdns,mclk-idx
  - "#sound-dai-cells"

additionalProperties: false

examples:
  - |
    #include <dt-bindings/interrupt-controller/irq.h>
    i2s_mc0: i2s@03040000 {
      compatible = "cdns,sky1-i2s-mc";
      reg = <0x0 0x03040000 0x0 0x10000>;
      interrupts = <GIC_SPI 88 IRQ_TYPE_LEVEL_HIGH>;
      clocks = <&clks 1>, <&clks 2>, <&clks 3>;
      clock-names = "hst", "i2s", "mclk";
      dmas = <&dma>, <&dma>;
      dma-names = "tx", "rx";
      cdns,pin-out-num = /bits/ 8 <8>;
      cdns,pin-tx-mask = /bits/ 8 <15>; /* 0x0f, pin0-pin3 works as transmitter */
      cdns,pin-rx-mask = /bits/ 8 <240>; /* 0xf0, pin4-pin7 works as receiver */
      #sound-dai-cells = <1>;
    }
